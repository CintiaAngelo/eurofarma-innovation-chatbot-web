<main class="admin-container">
    <div class="admin-card">
        <div class="tab-header">
            <nav class="tab-navigation">
                <button (click)="selectTab('newsletters')" class="tab-button"
                        [ngClass]="{'tab-button-active': activeTab === 'newsletters'}">
                    Newsletters
                </button>
                <button (click)="selectTab('ideas')" class="tab-button"
                        [ngClass]="{'tab-button-active': activeTab === 'ideas'}">
                    Ideias Recebidas
                </button>
                <button (click)="selectTab('analytics')" class="tab-button"
                        [ngClass]="{'tab-button-active': activeTab === 'analytics'}">
                    Analytics
                </button>
            </nav>
        </div>
        
        @if (activeTab === 'newsletters') {
            <div class="tab-content" [class.active]="activeTab === 'newsletters'">
                <div class="tab-content-header">
                    <h2 class="tab-title">Newsletters Semanais</h2>
                    <button (click)="openNewsletterModal()" class="action-button">
                        <i data-feather="plus"></i> Nova Newsletter
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead class="table-header">
                            <tr>
                                <th>Data</th>
                                <th>T√≠tulo</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">
                            @for (item of newsletters; track item.id_newsletter) {
                                <tr>
                                    <td>{{ item.data_envio_programada | date: 'dd/MM/yyyy' }}</td>
                                    <td>{{ item.titulo }}</td>
                                    <td>
                                        <span class="status-badge status-sent">{{ item.status_envio }}</span>
                                    </td>
                                    <td>
                                        <button class="action-icon-button"><i data-feather="eye"></i></button>
                                        <button class="action-icon-button action-edit"><i data-feather="edit"></i></button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }

        @if (activeTab === 'ideas') {
            <div class="tab-content" [class.active]="activeTab === 'ideas'">
                <div class="tab-content-header">
                    <h2 class="tab-title">Ideias Recebidas</h2>
                    <div class="filter-controls">
                        <div class="select-wrapper">
                            <select class="filter-select" [(ngModel)]="filterStatus" (change)="applyFiltersAndSort()">
                                <option value="todos">Filtrar por status</option>
                                @for (status of ideaStatuses; track status) {
                                  <option [value]="status">{{ status }}</option>
                                }
                            </select>
                            <i data-feather="chevron-down"></i>
                        </div>
                        <div class="select-wrapper">
                            <select class="filter-select" [(ngModel)]="sortOrder" (change)="applyFiltersAndSort()">
                                <option value="data-desc">Ordenar por data (mais recente)</option>
                                <option value="data-asc">Ordenar por data (mais antiga)</option>
                                <option value="departamento">Ordenar por Departamento</option>
                            </select>
                            <i data-feather="chevron-down"></i>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead class="table-header">
                            <tr>
                                <th>Data</th>
                                <th>Colaborador</th>
                                <th>Departamento</th>
                                <th>Ideia</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody class="table-body">
                            @for (idea of paginatedIdeas; track idea.id_ideia) {
                                <tr>
                                    <td>{{ idea.data_submissao | date: 'dd/MM/yyyy' }}</td>
                                    <td>
                                        <div class="user-name">{{ idea.nome }}</div>
                                        <div class="user-email">{{ idea.email }}</div>
                                    </td>
                                    <td>{{ idea.departamento }}</td>
                                    <td>
                                        <div class="idea-title">{{ idea.titulo_ideia }}</div>
                                    </td>
                                    <td>
                                        <span class="status-badge"
                                            [ngClass]="{
                                                'status-submitted': idea.status_ideia === 'Submetida',
                                                'status-review': idea.status_ideia === 'Em an√°lise',
                                                'status-received': idea.status_ideia === 'Recebida',
                                                'status-implemented': idea.status_ideia === 'Implementada',
                                                'status-sent': idea.status_ideia === 'Aprovada'
                                            }">
                                            {{ idea.status_ideia }}
                                        </span>
                                    </td>
                                    <td>
                                        <button (click)="viewIdea(idea)" class="action-icon-button"><i data-feather="eye"></i></button>
                                        <button (click)="editIdea(idea)" class="action-icon-button action-edit"><i data-feather="edit"></i></button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @if (totalItems > itemsPerPage) {
                  <div class="pagination-controls">
                      <div class="pagination-info">
                          Mostrando <span class="font-medium">{{ (currentPage - 1) * itemsPerPage + 1 }}</span> a <span class="font-medium">{{ (currentPage * itemsPerPage) > totalItems ? totalItems : (currentPage * itemsPerPage) }}</span> de <span class="font-medium">{{ totalItems }}</span> resultados
                      </div>
                      <div class="pagination-buttons">
                          <button (click)="prevPage()" [disabled]="currentPage === 1" class="pagination-btn">Anterior</button>
                          @for (page of visiblePages; track page) {
                              <button (click)="goToPage(page)" [class.active]="currentPage === page" class="pagination-btn pagination-number-btn">{{ page }}</button>
                          }
                          <button (click)="nextPage()" [disabled]="currentPage === totalPages" class="pagination-btn">Pr√≥xima</button>
                      </div>
                  </div>
                }
            </div>
        }

@if (activeTab === 'analytics') {
  <div class="tab-content" [class.active]="activeTab === 'analytics'">
    <h2 class="tab-title">Analytics</h2>
    
    <!-- M√©tricas Principais -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="metric-card">
        <div class="metric-header">
          <h3 class="metric-title">Total de Ideias</h3>
          <span class="metric-badge metric-badge-blue">+12%</span>
        </div>
        <p class="metric-value">{{ analytics.totalIdeas }}</p>
        <p class="metric-description">Desde o in√≠cio do programa</p>
      </div>
      <div class="metric-card">
        <div class="metric-header">
          <h3 class="metric-title">Ideias Implementadas</h3>
          <span class="metric-badge metric-badge-green">+8%</span>
        </div>
        <p class="metric-value">{{ analytics.implementedIdeas }}</p>
        <p class="metric-description">{{ analytics.implementationRate | number:'1.1-1' }}% do total</p>
      </div>
      <div class="metric-card">
        <div class="metric-header">
          <h3 class="metric-title">Pontos Distribu√≠dos</h3>
          <span class="metric-badge metric-badge-gold">+15%</span>
        </div>
        <p class="metric-value">{{ analytics.pointsDistributed }}</p>
        <p class="metric-description">10 pontos por ideia</p>
      </div>
      <div class="metric-card">
        <div class="metric-header">
          <h3 class="metric-title">Tempo M√©dio</h3>
          <span class="metric-badge metric-badge-blue">-5%</span>
        </div>
        <p class="metric-value">{{ analytics.avgImplementationTime | number:'1.0-0' }}d</p>
        <p class="metric-description">Para implementa√ß√£o</p>
      </div>
    </div>
    
    <!-- Gr√°ficos e Estat√≠sticas -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- Ideias por Departamento -->
      <div class="chart-card">
        <h3 class="chart-title">Ideias por Departamento</h3>
        <div class="chart-container">
          @for (dept of analytics.ideasByDepartment; track dept.departamento) {
            <div class="chart-bar-item">
              <div class="chart-bar-label">{{ dept.departamento }}</div>
              <div class="chart-bar-track">
                <div class="chart-bar-fill" 
                     [style.width.%]="(dept.count / analytics.totalIdeas) * 100">
                  <span class="chart-bar-value">{{ dept.count }}</span>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
      
      <!-- Status das Ideias -->
      <div class="chart-card">
        <h3 class="chart-title">Status das Ideias</h3>
        <div class="chart-pie-container">
          @for (status of analytics.ideasByStatus; track status.status_ideia) {
            <div class="chart-pie-item">
              <div class="chart-pie-color" 
                   [style.background]="getStatusColor(status.status_ideia)"></div>
              <span class="chart-pie-label">{{ status.status_ideia }}</span>
              <span class="chart-pie-value">{{ status.count }} ({{ (status.count / analytics.totalIdeas) * 100 | number:'1.1-1' }}%)</span>
            </div>
          }
        </div>
      </div>
    </div>
    
    <!-- Top Colaboradores e Departamentos -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- Top 5 Colaboradores -->
      <div class="chart-card">
        <h3 class="chart-title">Top 5 Colaboradores üèÜ</h3>
        <div class="top-list">
          @for (employee of analytics.topEmployees; track employee.nome; let i = $index) {
            <div class="top-list-item">
              <div class="top-list-rank">{{ i + 1 }}</div>
              <div class="top-list-avatar">{{ employee.nome?.charAt(0) }}</div>
              <div class="top-list-info">
                <p class="top-list-name">{{ employee.nome }}</p>
                <p class="top-list-detail">{{ employee.departamento }}</p>
              </div>
              <div class="top-list-points">
                <i data-feather="star"></i> {{ employee.pontos_gamificacao }}
              </div>
            </div>
          }
        </div>
      </div>
      
      <!-- Departamentos Mais Engajados -->
      <div class="chart-card">
        <h3 class="chart-title">Departamentos Mais Engajados</h3>
        <div class="engagement-list">
          @for (dept of analytics.activeDepts; track dept.departamento; let i = $index) {
            <div class="engagement-item">
              <div class="engagement-rank">{{ i + 1 }}</div>
              <div class="engagement-info">
                <p class="engagement-name">{{ dept.departamento }}</p>
                <p class="engagement-detail">{{ dept.ideas_submitted }} ideias</p>
              </div>
              <div class="engagement-bar">
                <div class="engagement-bar-fill" 
                     [style.width.%]="(dept.ideas_submitted / analytics.totalIdeas) * 100">
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
    
    <!-- Evolu√ß√£o Mensal -->
    <div class="chart-card mb-8">
      <h3 class="chart-title">Evolu√ß√£o Mensal de Ideias</h3>
      <div class="monthly-chart">
        @for (month of analytics.ideasByMonth; track month.month) {
          <div class="monthly-bar">
            <div class="monthly-bar-fill" 
                 [style.height.%]="(month.count / getMaxMonthlyIdeas()) * 100">
              <span class="monthly-bar-value">{{ month.count }}</span>
            </div>
            <span class="monthly-bar-label">{{ month.month | date:'MMM' }}</span>
          </div>
        }
      </div>
    </div>
  </div>
}
        
        @if (showModal) {
            <div class="modal-overlay">
                <div class="modal-card">
                    <div class="modal-header">
                        <h3 class="modal-title">{{ isEditing ? 'Editar Ideia' : 'Nova Newsletter' }}</h3>
                        <button (click)="closeModal()" class="modal-close-button">
                            <i data-feather="x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        @if (!isEditing) {
                            <form (ngSubmit)="onSubmitNewsletter()">
                                <div class="form-group">
                                    <label class="form-label">T√≠tulo</label>
                                    <input type="text" [(ngModel)]="newNewsletter.titulo" name="newsletterTitle" class="form-input" placeholder="Ex: Novidades da Semana">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Conte√∫do</label>
                                    <textarea [(ngModel)]="newNewsletter.conteudo" name="newsletterContent" rows="5" class="form-input" placeholder="Digite o conte√∫do aqui..."></textarea>
                                </div>
                                <div class="form-actions">
                                    <button type="button" (click)="closeModal()" class="cancel-button">Cancelar</button>
                                    <button type="submit" class="submit-button">Salvar e Enviar</button>
                                </div>
                            </form>
                        }
                        @if (isEditing) {
                            <form (ngSubmit)="saveModalIdea()">
                                <div class="form-group">
                                    <label class="form-label">T√≠tulo</label>
                                    <input type="text" [(ngModel)]="modalIdea.titulo_ideia" name="titulo_ideia" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Descri√ß√£o</label>
                                    <textarea [(ngModel)]="modalIdea.descricao_ideia_clob" name="descricao_ideia_clob" rows="5" class="form-input"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Status</label>
                                    <select [(ngModel)]="modalIdea.status_ideia" name="status_ideia" class="form-input">
                                        @for (status of ideaStatuses; track status) {
                                            <option [value]="status">{{ status }}</option>
                                        }
                                    </select>
                                </div>
                                <div class="form-actions form-actions-between" [style.justifyContent]="isEditing ? 'space-between' : 'flex-end'">
                                    <button type="button" (click)="closeModal()" class="cancel-button">Fechar</button>
                                    <button type="submit" class="submit-button">Salvar</button>
                                </div>
                            </form>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</main>